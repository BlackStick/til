## 効率的なログ収集方法と分析のためのNotebook
---
### 会社
---
- グリー

#### 分析例
- 流行パーティ
- アソシエーション分析

#### データパイプライン
- データレイク
  - データレイクは、「様々なデータを最初から収集して、何か活用（分析）をしようと思い立った時、すぐに実行できること」が特徴
- 二つのプロダクトから分析
  - ログをデータレイクで一元管理しているので二つのプロジェクトで収集した情報を分析できる
- データレイクにJSONで保存

### ログ収集
---
#### ツール・サービス
---
- ローカルNotebook
- Jupyter Notebook
  - クエリだけでは把握しにくかった情報の把握が容易になった
  - データサイエンス分野でよく使用されているOSS
  - バッチ処理には向いていない
  - BIツール
- JupyterHub
  - メリット
    - 利用者毎の初期設定が必要ない
  - デメリット
    - コストが掛かる
- AWS EMR
  - 集計（API経由で操作）
- pandasのデータフレーム
  - Excelのような2次元のテーブルを対象にしたライブラリ
  - Pythonで数値処理や統計処理、機械学習を行う際にnumpyなどと共によく利用されます。

#### サーバー側
---
##### 目的
- 問い合わせ対応
- 分析に使用
 
##### 収集するデータ
- データの変更は全てロギング
  - アクセスなどはWebサーバー上でロギング

##### Note
- ログ収集は設計しないでどんどん収集
  - ログのスキーマが変更されることはほとんどない

#### クライアント側
---
##### 目的
- 分析に使用

##### 収集方法
- td-sdkでクライアントからログ収集
  - [Treasure Data JavaScript SDK](https://qiita.com/kzk9/items/15f4e01cafa30fb8e7a5)

##### Note
- ログのスキーマが変更されることはほとんどない
- クライアント側でした収集できないログ

### Notebookを導入後
---
- 複雑な処理が簡単になった
- 計算結果を見ながら試行錯誤が用意
- 分析と同時に共有資料が作れる
- 分析過程の共有が簡単なので、他の人も同様の分析がすぐできる

#### 悪かった点
- Pythonが書けない人にとっては辛いかも

### その他
---
- DynamoDB Streamを採用している理由は、変更の差分を流す機能があるから。
- 収集されたログはKinesisに送られる
  - 書き込み制限がかからないようにバッファリングされるのでKinesis
  - S3にJSONで保存
- ログ遅延
  - ゲームのアーキテクチャー上避けられない
- コンパクション
  - ログ遅延によりコンパクションできない
  - 対策
    - 毎日コンパクションし直す